<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
  <sys_script_include action="INSERT_OR_UPDATE">
    <access>public</access>
    <active>true</active>
    <api_name>sn_fcms_intg.PostGoodsReceiptService</api_name>
    <caller_access/>
    <client_callable>false</client_callable>
    <description/>
    <name>PostGoodsReceiptService</name>
    <script><![CDATA[var PostGoodsReceiptService = Class.create();

PostGoodsReceiptService.sendReceipt = function(erpSourceId, receiptId) {
    var response = {};
    try {
		var erpConfig = new sn_fcms_intg.ErpSourceConfig(erpSourceId);
		var erpConfigId = erpConfig.getValue('sys_id');
		var input = {};
		input.sn_shop_receipt= "sys_id=" + receiptId;
		var context = {"erp_source": erpSourceId,
					  "erp_config": erpConfigId,
					  "receipt_id": receiptId};
		response = sn_fcms_intg.ErpIntegrator.doService(SpendIntgConstants.ERP_SERVICE_POST_GR,
												 erpConfig, 
												 input, 
												 context);

		if(response.status != IntgConstants.STATUS_SUCCESS){
			var msg = gs.getMessage('Error in posting goods receipt data for {0}', erpConfig.getValue('name'));
			gs.error(msg);
			sn_shop.SpendTaskUtil.createGRIntegrationErrorTask(receiptId, msg);
		}
		
	} catch (ex) {
        gs.error(ex);
        response.status = sn_fcms_intg.IntgConstants.STATUS_FAIL;
        response.message = ex.message;
    }
    return response;
};

PostGoodsReceiptService.handleResponse = function(result){
	var response = result.response;
	var context = result.context;
	
	if (response.status != 200)
		sn_shop.SpendTaskUtil.createGRIntegrationErrorTask(context.receipt_id, response.error.error_message);	
};

PostGoodsReceiptService.prototype = {
    initialize: function() {
    },

    type: 'PostGoodsReceiptService'
};]]></script>
    <sys_class_name>sys_script_include</sys_class_name>
    <sys_created_by>admin</sys_created_by>
    <sys_created_on>2020-02-03 11:52:40</sys_created_on>
    <sys_id>90418070b7b2001030bbf238ee11a9b4</sys_id>
    <sys_mod_count>9</sys_mod_count>
    <sys_name>PostGoodsReceiptService</sys_name>
    <sys_package display_value="Finance - ERP Integration" source="sn_fcms_intg">0b4eadd1531113008f12ddeeff7b126d</sys_package>
    <sys_policy>read</sys_policy>
    <sys_scope display_value="Finance - ERP Integration">0b4eadd1531113008f12ddeeff7b126d</sys_scope>
    <sys_update_name>sys_script_include_90418070b7b2001030bbf238ee11a9b4</sys_update_name>
    <sys_updated_by>admin</sys_updated_by>
    <sys_updated_on>2020-02-27 13:55:43</sys_updated_on>
  </sys_script_include>
</record_update>
