<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
  <sys_script_include action="INSERT_OR_UPDATE">
    <access>public</access>
    <active>true</active>
    <api_name>sn_fcms_intg.PostInvoiceService</api_name>
    <caller_access/>
    <client_callable>false</client_callable>
    <description/>
    <name>PostInvoiceService</name>
    <script><![CDATA[var PostInvoiceService = Class.create();

PostInvoiceService.sendInvoice = function(erpSourceId, invoiceId) {
    var response = {};
    try {
		var result = {};
		var erpConfig = new sn_fcms_intg.ErpSourceConfig(erpSourceId);
		var erpConfigId = erpConfig.getValue('sys_id');
		var input = {};
		input.sn_shop_invoice= "sys_id=" + invoiceId;
		var context = {"erp_source": erpSourceId,
					  "erp_config": erpConfigId,
					  "invoice_id": invoiceId};
		response = sn_fcms_intg.ErpIntegrator.doService(SpendIntgConstants.ERP_SERVICE_POST_INVOICE,
												 erpConfig, 
												 input, 
												 context);

		if(response.status != IntgConstants.STATUS_SUCCESS)
			gs.error("Error in posting invoice data for " + erpConfig.getValue('name'));
		
	} catch (ex) {
        gs.error(ex);
        response.status = sn_fcms_intg.IntgConstants.STATUS_FAIL;
        response.message = ex.message;
    }

	//create integration error task
	if (response.status == sn_fcms_intg.IntgConstants.STATUS_FAIL)
		sn_shop.SpendTaskUtil.createInvoiceIntegrationErrorTask(invoiceGr.getValue('sys_id'), response.message);

	return response;
};

PostInvoiceService.handleResponse = function(result){
	var response = result.response;
	var context = result.context;
	
	if (response.status != 200)
		sn_shop.SpendTaskUtil.createInvoiceIntegrationErrorTask(context.invoice_id, response.error.error_message);
	
}

PostInvoiceService.prototype = {
    initialize: function() {
    },

    type: 'PostInvoiceService'
};]]></script>
    <sys_class_name>sys_script_include</sys_class_name>
    <sys_created_by>admin</sys_created_by>
    <sys_created_on>2020-02-06 19:45:27</sys_created_on>
    <sys_id>c9190db95372001030bbddeeff7b1271</sys_id>
    <sys_mod_count>4</sys_mod_count>
    <sys_name>PostInvoiceService</sys_name>
    <sys_package display_value="Finance - ERP Integration" source="sn_fcms_intg">0b4eadd1531113008f12ddeeff7b126d</sys_package>
    <sys_policy>read</sys_policy>
    <sys_scope display_value="Finance - ERP Integration">0b4eadd1531113008f12ddeeff7b126d</sys_scope>
    <sys_update_name>sys_script_include_c9190db95372001030bbddeeff7b1271</sys_update_name>
    <sys_updated_by>admin</sys_updated_by>
    <sys_updated_on>2020-03-10 19:38:49</sys_updated_on>
  </sys_script_include>
</record_update>
